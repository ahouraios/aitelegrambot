import os
import requests
from flask import Flask, request

# --- ۱. تنظیمات اولیه ---
# توکن ربات از متغیرهای محیطی خوانده می‌شود
BOT_TOKEN = os.environ.get('BOT_TOKEN')

# ساخت اپلیکیشن فلسک
app = Flask(__name__)


# --- ۲. تعریف روت اصلی ---
# این تنها روت برنامه ماست و دو کار انجام می‌دهد:
# الف) به درخواست‌های GET (مثل پینگ UptimeRobot) پاسخ "OK" می‌دهد.
# ب) به درخواست‌های POST (که حاوی آپدیت‌های تلگرام هستند) گوش می‌دهد.
@app.route('/', methods=['GET', 'POST'])
def webhook_handler():
    # اگر درخواست از نوع POST بود، یعنی تلگرام یک آپدیت فرستاده است
    if request.method == 'POST':
        # در اینجا منطق اصلی ربات شما برای پردازش پیام‌ها قرار خواهد گرفت
        # فعلاً فقط یک پیام موفقیت‌آمیز برمی‌گردانیم تا تلگرام بداند پیام رسیده است
        return 'OK', 200
    
    # اگر درخواست از نوع GET بود، یعنی یک سرویس در حال چک کردن سلامت برنامه است
    else:
        # این پیام به UptimeRobot نشان می‌دهد که سرویس شما فعال و سالم است
        return 'Ahourai Telegram Bot is running.', 200


# --- ۳. اجرای برنامه (برای تست محلی) ---
# این بخش فقط زمانی اجرا می‌شود که شما فایل را مستقیماً روی کامپیوتر خودتان اجرا کنید
# Render از این بخش استفاده نمی‌کند و وب‌سرور را با دستور gunicorn اجرا می‌کند
if __name__ == '__main__':
    app.run(debug=True, port=5000)
